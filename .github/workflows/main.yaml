name: CI

on:
    push:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up JDK 11
              uses: actions/setup-java@v3
              with:
                distribution: 'temurin'
                java-version: '11'

            - name: Build and package web application (skip tests)
              run: mvn clean package -DskipTests

            - name: Upload JAR artifact
              uses: actions/upload-artifact@v4
              with:
                name: app-jar
                path: target/*.jar

    test:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up JDK 11
              uses: actions/setup-java@v3
              with:
                distribution: 'temurin'
                java-version: '11'
        
            - name: Install Chrome
              uses: browser-actions/setup-chrome@v1

            - name: Install ChromeDriver
              run: |
                sudo apt-get update
                sudo apt-get install -y chromium-chromedriver
                sudo ln -s /usr/lib/chromium-browser/chromedriver /usr/bin/chromedriver

            - name: Start application
              run: nohup mvn spring-boot:run &

            - name: Run all tests (unit, integration, end-to-end)
              run: mvn verify